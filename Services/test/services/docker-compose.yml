version: '3.4'
services:
  test-services-client:
    image: ${ENV_REPOSITORY}/test-services-client
    build:
      context: ./test-services-client
      args:
        - BUILD_CONFIGURATION=tester
    environment:
      - LOG_LEVEL=debug
    volumes:
      - ./test-services-client/app:/app
      - ./../../services:/app/services
    depends_on:
      - mindlink1
      - mindlink2
      - test-services-server
      - couchdb
      - redis

  test-services-server:
    image: ${ENV_REPOSITORY}/test-services-server
    build:
      context: ./test-services-server
      args:
        - BUILD_CONFIGURATION=develop
    environment:
      - LOG_LEVEL=debug
    volumes:
      - ./test-services-server/app:/app
      - ./../../services:/app/services

  mindlink1:
    image: ${ENV_REPOSITORY}/mindlink
    build:
      context: ./../../mindlink
      args:
        - BUILD_CONFIGURATION=develop
    environment:
      - DEBUG_HTTP_CHANNEL_ENABLE=1
      - LOG_LEVEL=debug
    volumes:
      - ./../../mindlink/app:/app
      - ./../../services:/app/services
    ports:
      - 127.0.0.1:17766:17766
    depends_on:
      - rabbitmq

  mindlink2:
    image: ${ENV_REPOSITORY}/mindlink
    environment:
      - DEBUG_HTTP_CHANNEL_ENABLE=1
      - LOG_LEVEL=debug
    volumes:
      - ./../../mindlink/app:/app
      - ./../../services:/app/services
    ports:
      - 127.0.0.1:17767:17766
    depends_on:
      - rabbitmq

  rabbitmq:
    image: rabbitmq:3.7.0-management-alpine
    ports:
      - 127.0.0.1:15672:15672

  couchdb:
    image: couchdb:2.1.1
    ports:
      - 127.0.0.1:15984:5984

  redis:
    image: redis:4.0.6-alpine
    ports:
      - 127.0.0.1:6379:6379

