version: '3.3'
services:
  test-matching-client:
    image: newg-test-matching/test-matching-client
    build:
      context: ./../../test-matching-client
      args:
        - BUILD_CONFIGURATION=tester
    environment:
      - LOG_LEVEL=debug
    volumes:
      - ./../../test-matching-client/app:/app
      - ./../../../services:/app/services
    depends_on:
      - matching
      - mindlink

  matching:
    image: newg-test-matching/matching
    build:
      context: ./../../../matching
      args:
        - BUILD_CONFIGURATION=develop
    environment:
      - LOG_LEVEL=debug
    volumes:
      - ./../../../matching/app:/app
      - ./../../../services:/app/services
    depends_on:
      - mindlink
      - api

  api:
    image: newg-test-matching/api
    build:
      context: ./../../../api
      args:
        - BUILD_CONFIGURATION=develop
    environment:
      - COUCH_URL=http://couchdb:5984/testdb
      - REDIS_URL=redis://redis:6379/?db=99
      - LOG_LEVEL=debug
    volumes:
      - ./../../../api/app:/app
      - ./../../../services:/app/services
    ports:
      - 7780:7780
    depends_on:
      - mindlink
      - couchdb
      - redis

  mindlink:
    image: newg-test-matching/mindlink
    build:
      context:  ./../../../mindlink
      args:
        - BUILD_CONFIGURATION=develop
    volumes:
      - ./../../../mindlink/app:/app
      - ./../../../services:/app/services
    depends_on:
      - rabbitmq

  rabbitmq:
    image: rabbitmq:3.7.0-management-alpine
    ports:
      - 15672:15672

  couchdb:
    image: couchdb:2.1.1

  redis:
    image: redis:4.0.6-alpine

